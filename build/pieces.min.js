(function(){var e=[].slice;window.Pieces=function(){function t(){}return t.pieces=[],t.activePieces=[],t.modules={},t.bindEvents=function(e,t){var n,r,i,s,o,u,a,f,l;s=/on\s+([:]|[^\s]+)\s+(?:on|at|of|over|for)\s+(.*)/,o=/on\s+([:]|[^\s]+)/,l=[];for(i in t)n=t[i],(u=s.exec(i))?(f=[u[1],u[2]],r=f[0],a=f[1],l.push(function(n,r,i){var s=this;return jQuery(e).off(n,r).on(n,r,function(){return i.apply(t,arguments)})}(r,a,n))):(u=o.exec(i))?(r=u[1],l.push(function(n,r){var i=this;return jQuery(e).off(n).on(n,function(){return r.apply(t,arguments)})}(r,n))):l.push(void 0);return l},t.registerPiece=function(e,t){return this.pieces.push({selector:e,object:t})},t.initializePiece=function(t){var n,r,i,s,o,u,a,f=this;o=jQuery(t.selector).get(),a=[];for(i=0,s=o.length;i<s;i++)n=o[i],n=jQuery(n),n.data("__piece+"+t.selector)?a.push(void 0):(r={el:n,$:function(e){return jQuery(e,this.el)}},r.include=function(){var t,i,s,o;return i=arguments[0],o=2<=arguments.length?e.call(arguments,1):[],s=f.modules[i],jQuery.isFunction(s)&&(s=s.apply(r)),t=s.initialize,delete s.initialize,jQuery.extend(r,s),t!=null&&t.apply(r,o),f.bindEvents(n,r)},r=jQuery.extend(r,jQuery.isFunction(t.object)?t.object.apply(r):t.object),n.data("__piece+"+t.selector,r),this.bindEvents(n,r),this.activePieces.push({selector:t.selector,object:r}),a.push((u=r.initialize)!=null?u.apply(r):void 0));return a},t.update=function(){var e,t,n,r,i;r=this.pieces,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],jQuery(e.selector).size()>0?i.push(this.initializePiece(e)):i.push(void 0);return i},t.Module=function(e,t){return this.modules[e]=t},t}(),window.Piece=function(){var e;return(e=window.Pieces).registerPiece.apply(e,arguments)}}).call(this)