(function(){var e;if(typeof e=="undefined"||e===null)e=exports;e.Pieces=function(){function t(){}return t.pieces=[],t.activePieces=[],t.bindEvents=function(t,n){var r,i,s,o,u,a;s=/on\s+([:]|[^\s]+)\s+(?:on|at|of|over|for)\s+(.*)/,o=/on\s+([:]|[^\s]+)/,a=[];for(i in n)r=n[i],(u=s.exec(i))?a.push(function(r,i){var s=this;return e.jQuery(t).on(r[1],r[2],function(){return i.apply(n,arguments)})}(u,r)):(u=o.exec(i))?a.push(function(r,i){var s=this;return e.jQuery(t).on(r[1],function(){return i.apply(n,arguments)})}(u,r)):a.push(void 0);return a},t.registerPiece=function(e,t){return this.pieces.push({selector:e,object:t})},t.initializePiece=function(t){var n,r,i,s,o,u,a;r=e.jQuery(t.selector);if(!r.size())return;a=[];for(s=0,o=r.length;s<o;s++)n=r[s],n=e.jQuery(n),n.data("__piece+"+t.selector)?a.push(void 0):(i={$:function(t){return e.jQuery(t,this.el)}},typeof t.object=="function"?i=e.jQuery.extend(i,t.object.apply(i)):i=e.jQuery.extend(i,t.object),i.el=n,n.data("__piece+"+t.selector,i),this.bindEvents(n,i),this.activePieces.push({selector:t.selector,object:i}),a.push((u=i.initialize)!=null?u.apply(i):void 0));return a},t.update=function(){var t,n,r,i,s;i=this.pieces,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],e.jQuery(t.selector).size()>0?s.push(this.initializePiece(t)):s.push(void 0);return s},t}(),e.Piece=function(){var t;return(t=e.Pieces).registerPiece.apply(t,arguments)}}).call(this)